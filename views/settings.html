<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç³»ç»Ÿè®¾ç½® - ç°ä»£å›¾åºŠ</title>
  <link rel="stylesheet" href="/css/style.css">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%234361ee'><path d='M4 5h13v7h2V5c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h8v-2H4V5zm19 7v10c0 1.1-.9 2-2 2H8c-1.1 0-2-.9-2-2V12c0-1.1.9-2 2-2h13c1.1 0 2 .9 2 2zm-2 0H8v10h13V12z'/></svg>">
</head>
<body>
  <header class="header">
    <div class="container header-content">
      <a href="/" class="logo">ç°ä»£å›¾åºŠ</a>
      <nav class="nav">
        <a href="/" class="btn btn-outline">é¦–é¡µ</a>
        <a href="/gallery" class="btn btn-outline">æˆ‘çš„å›¾ç‰‡åº“</a>
        <a href="/settings" class="btn btn-primary">ç³»ç»Ÿè®¾ç½®</a>
        <button id="toggleDarkMode" class="btn btn-outline">æš—è‰²æ¨¡å¼</button>
        <a href="/logout" class="btn btn-outline">é€€å‡º</a>
      </nav>
    </div>
  </header>

  <main class="container settings-container">
    <div class="page-header">
      <h1>ç³»ç»Ÿè®¾ç½®</h1>
      <p class="subtitle">ç®¡ç†å›¾åºŠç³»ç»Ÿçš„å„é¡¹é…ç½®</p>
    </div>

    <div class="settings-layout">
      <!-- ä¾§è¾¹æ å¯¼èˆª -->
      <aside class="settings-sidebar">
        <nav class="settings-nav">
          <a href="#image-quality" class="nav-item active" data-section="image-quality">
            <span class="nav-icon">ğŸ¨</span>
            å›¾ç‰‡è´¨é‡è®¾ç½®
          </a>
          <a href="#api-management" class="nav-item" data-section="api-management">
            <span class="nav-icon">ğŸ”§</span>
            APIç®¡ç†
          </a>
          <a href="#storage-config" class="nav-item" data-section="storage-config">
            <span class="nav-icon">ğŸ’¾</span>
            å­˜å‚¨é…ç½®
          </a>
        </nav>
      </aside>

      <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
      <div class="settings-content">
        <!-- å›¾ç‰‡è´¨é‡è®¾ç½® -->
        <section id="image-quality-section" class="settings-section active">
          <div class="section-header">
            <h2>å›¾ç‰‡è´¨é‡è®¾ç½®</h2>
            <p class="section-description">é…ç½®å›¾ç‰‡æ ¼å¼è½¬æ¢æ—¶çš„è´¨é‡å‚æ•°ï¼Œå½±å“æ–‡ä»¶å¤§å°å’Œå›¾ç‰‡è´¨é‡</p>
          </div>

          <div class="config-content">
            <form id="qualitySettingsForm">
              <!-- WebPè´¨é‡è®¾ç½® -->
              <div class="form-group">
                <label for="webpQuality" class="form-label">
                  WebP è´¨é‡
                  <span class="quality-value" id="webpQualityValue">80</span>%
                </label>
                <div class="quality-control">
                  <input type="range" id="webpQuality" name="webpQuality" min="10" max="100" value="80" class="quality-slider">
                  <div class="quality-info">
                    <span class="quality-desc" id="webpQualityDesc">é«˜è´¨é‡</span>
                    <small class="quality-hint">æ¨è: 80-90ï¼ˆå¹³è¡¡è´¨é‡ä¸æ–‡ä»¶å¤§å°ï¼‰</small>
                  </div>
                </div>
              </div>

              <!-- AVIFè´¨é‡è®¾ç½® -->
              <div class="form-group">
                <label for="avifQuality" class="form-label">
                  AVIF è´¨é‡
                  <span class="quality-value" id="avifQualityValue">75</span>%
                </label>
                <div class="quality-control">
                  <input type="range" id="avifQuality" name="avifQuality" min="10" max="100" value="75" class="quality-slider">
                  <div class="quality-info">
                    <span class="quality-desc" id="avifQualityDesc">é«˜è´¨é‡</span>
                    <small class="quality-hint">æ¨è: 70-80ï¼ˆAVIFå‹ç¼©æ•ˆç‡æ›´é«˜ï¼‰</small>
                  </div>
                </div>
              </div>

              <!-- PNGä¼˜åŒ–è®¾ç½® -->
              <div class="form-group">
                <label for="pngOptimize" class="form-label">PNG ä¼˜åŒ–</label>
                <div class="checkbox-group">
                  <label class="checkbox-label">
                    <input type="checkbox" id="pngOptimize" name="pngOptimize" checked>
                    <span class="checkmark"></span>
                    å¯ç”¨PNGå‹ç¼©ä¼˜åŒ–ï¼ˆå‡å°æ–‡ä»¶å¤§å°ï¼Œä¸å½±å“è´¨é‡ï¼‰
                  </label>
                </div>
              </div>

              <div class="action-buttons">
                <button type="button" id="resetDefaults" class="btn btn-secondary">æ¢å¤é»˜è®¤</button>
                <button type="submit" class="btn btn-primary">ä¿å­˜è®¾ç½®</button>
              </div>
            </form>
          </div>

          <!-- é¢„è®¾è´¨é‡æ¨¡æ¿ -->
          <div class="section-header">
            <h3>è´¨é‡é¢„è®¾</h3>
            <p class="section-description">å¿«é€Ÿåº”ç”¨é¢„å®šä¹‰çš„è´¨é‡é…ç½®</p>
          </div>

          <div class="config-content">
            <div class="preset-grid">
              <div class="preset-card" data-preset="high">
                <h4>é«˜è´¨é‡</h4>
                <p class="preset-desc">WebP: 92%, AVIF: 85%</p>
                <p class="preset-usage">é€‚åˆï¼šæ‘„å½±ä½œå“ã€é‡è¦å›¾ç‰‡</p>
                <button class="btn btn-outline preset-btn">åº”ç”¨</button>
              </div>
              
              <div class="preset-card" data-preset="balanced">
                <h4>å¹³è¡¡æ¨¡å¼</h4>
                <p class="preset-desc">WebP: 80%, AVIF: 75%</p>
                <p class="preset-usage">é€‚åˆï¼šæ—¥å¸¸ä½¿ç”¨ã€ç½‘ç«™å›¾ç‰‡</p>
                <button class="btn btn-outline preset-btn">åº”ç”¨</button>
              </div>
              
              <div class="preset-card" data-preset="compressed">
                <h4>é«˜å‹ç¼©</h4>
                <p class="preset-desc">WebP: 65%, AVIF: 60%</p>
                <p class="preset-usage">é€‚åˆï¼šç¼©ç•¥å›¾ã€å¤§æ‰¹é‡å¤„ç†</p>
                <button class="btn btn-outline preset-btn">åº”ç”¨</button>
              </div>
            </div>
          </div>
        </section>

        <!-- APIç®¡ç†éƒ¨åˆ† -->
        <section id="api-management-section" class="settings-section">
          <div class="section-header">
            <h2>APIç®¡ç†</h2>
            <p class="section-description">ç®¡ç†APIä»¤ç‰Œå’Œè®¾ç½®ï¼Œæ–¹ä¾¿ä¸ç¬¬ä¸‰æ–¹å·¥å…·é›†æˆ</p>
          </div>

          <div class="settings-row">
            <div class="settings-col-main">
              <!-- APIçŠ¶æ€è®¾ç½® -->
              <div class="config-section">
                <div class="config-header">
                  <h3>APIçŠ¶æ€</h3>
                </div>
                <div class="config-content">
                  <div class="api-switch">
                    <input class="form-check-input" type="checkbox" id="apiEnabledSwitch">
                    <label class="form-check-label" for="apiEnabledSwitch">å¯ç”¨API</label>
                  </div>
                  
                  <div id="apiDisabledWarning" style="display: none;" class="alert alert-warning">
                    APIåŠŸèƒ½å½“å‰å·²ç¦ç”¨ï¼Œå³ä½¿æœ‰æœ‰æ•ˆçš„ä»¤ç‰Œä¹Ÿæ— æ³•è®¿é—®APIã€‚
                  </div>

                  <div class="format-radio-group">
                    <h4>APIä¸Šä¼ å›¾ç‰‡æ ¼å¼è®¾ç½®</h4>
                    <div class="radio-group">
                      <div class="radio-item">
                        <input type="radio" name="defaultFormat" value="original" id="format-original">
                        <label for="format-original">ä¿æŒåŸå§‹æ ¼å¼</label>
                      </div>
                      <div class="radio-item">
                        <input type="radio" name="defaultFormat" value="webp" id="format-webp">
                        <label for="format-webp">è½¬ä¸ºWebP</label>
                      </div>
                      <div class="radio-item">
                        <input type="radio" name="defaultFormat" value="avif" id="format-avif">
                        <label for="format-avif">è½¬ä¸ºAVIF</label>
                      </div>
                    </div>
                    <p class="form-help">æ­¤è®¾ç½®å°†åº”ç”¨äºæ‰€æœ‰é€šè¿‡APIä¸Šä¼ çš„å›¾ç‰‡ã€‚å¦‚æœAPIè¯·æ±‚ä¸­æœªæŒ‡å®šformatå‚æ•°ï¼Œå°†ä½¿ç”¨æ­¤é»˜è®¤è®¾ç½®ã€‚</p>
                  </div>
                </div>
              </div>

              <!-- åˆ›å»ºæ–°ä»¤ç‰Œ -->
              <div class="config-section">
                <div class="config-header">
                  <h3>åˆ›å»ºæ–°ä»¤ç‰Œ</h3>
                </div>
                <div class="config-content">
                  <form id="createTokenForm">
                    <div class="form-group">
                      <label for="tokenName" class="form-label">ä»¤ç‰Œåç§°</label>
                      <input type="text" class="form-control" id="tokenName" placeholder="ä¾‹å¦‚ï¼šPicGoå®¢æˆ·ç«¯" required>
                      <div class="form-help">ç”¨äºæ ‡è¯†æ­¤ä»¤ç‰Œçš„ç”¨é€”</div>
                    </div>
                    <button type="submit" class="btn btn-primary">åˆ›å»ºä»¤ç‰Œ</button>
                  </form>
                  
                  <div id="newTokenInfo" style="display: none;" class="alert alert-success">
                    <p><strong>æ–°ä»¤ç‰Œå·²åˆ›å»º!</strong> è¯·ä¿å­˜æ­¤ä»¤ç‰Œï¼Œå®ƒåªä¼šæ˜¾ç¤ºä¸€æ¬¡ã€‚</p>
                    <div class="new-token-value" id="newTokenValue"></div>
                    <button class="btn btn-secondary" onclick="copyNewToken()">å¤åˆ¶ä»¤ç‰Œ</button>
                  </div>
                </div>
              </div>

              <!-- ç°æœ‰ä»¤ç‰Œ -->
              <div class="config-section">
                <div class="config-header">
                  <h3>ç°æœ‰ä»¤ç‰Œ</h3>
                </div>
                <div class="config-content">
                  <div id="tokenList" class="token-list">
                    <div id="noTokensMessage" class="no-data-message">æš‚æ— ä»¤ç‰Œ</div>
                  </div>
                </div>
              </div>
            </div>

            <div class="settings-col-sidebar">
              <!-- APIä½¿ç”¨è¯´æ˜ -->
              <div class="config-section">
                <div class="config-header">
                  <h3>APIä½¿ç”¨è¯´æ˜</h3>
                </div>
                <div class="config-content">
                  <p>æ‚¨å¯ä»¥é€šè¿‡APIä¸Šä¼ å›¾ç‰‡ï¼Œæ–¹ä¾¿ä¸ç¬¬ä¸‰æ–¹å·¥å…·é›†æˆã€‚</p>
                  
                  <div class="info-box">
                    <h4>PicGoè®¾ç½®</h4>
                    <p>åœ¨PicGoä¸­æ·»åŠ è‡ªå®šä¹‰å›¾åºŠï¼š</p>
                    <ul>
                      <li><strong>ä¸Šä¼ åœ°å€</strong>: <code id="apiEndpoint"></code></li>
                      <li><strong>è¯·æ±‚æ–¹å¼</strong>: POST</li>
                      <li><strong>è‡ªå®šä¹‰è¯·æ±‚å¤´</strong>: <code>x-api-token</code> å¡«å…¥æ‚¨çš„ä»¤ç‰Œ</li>
                      <li><strong>å›¾ç‰‡ä¸Šä¼ å­—æ®µå</strong>: images</li>
                      <li><strong>è‡ªå®šä¹‰URLéƒ¨åˆ†</strong>: <code>picgo=true</code></li>
                      <li><strong>è¿”å›å€¼å­—æ®µ</strong>: result</li>
                    </ul>
                  </div>

                  <h4>APIç«¯ç‚¹</h4>
                  <ul>
                    <li><code>/api/upload</code> - ä¸Šä¼ å›¾ç‰‡</li>
                    <li>å¯é€‰å‚æ•° <code>format</code>: 
                      <ul>
                        <li><code>original</code> - ä¿æŒåŸå§‹æ ¼å¼</li>
                        <li><code>webp</code> - è½¬æ¢ä¸ºWebPæ ¼å¼</li>
                        <li><code>avif</code> - è½¬æ¢ä¸ºAVIFæ ¼å¼</li>
                      </ul>
                    </li>
                  </ul>
                  
                  <h4>è®¤è¯æ–¹å¼</h4>
                  <p>ä½¿ç”¨ä»¥ä¸‹ä»»ä¸€æ–¹å¼æä¾›ä»¤ç‰Œï¼š</p>
                  <ul>
                    <li>è¯·æ±‚å¤´: <code>x-api-token: æ‚¨çš„ä»¤ç‰Œ</code></li>
                    <li>URLå‚æ•°: <code>?token=æ‚¨çš„ä»¤ç‰Œ</code></li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- å­˜å‚¨é…ç½®éƒ¨åˆ† -->
        <section id="storage-config-section" class="settings-section">
          <div class="section-header">
            <h2>å­˜å‚¨é…ç½®</h2>
            <p class="section-description">é…ç½®å›¾ç‰‡å­˜å‚¨æ–¹å¼ï¼Œé€‰æ‹©æœ¬åœ°å­˜å‚¨æˆ–äº‘ç«¯å­˜å‚¨</p>
          </div>

          <div class="alert alert-info">
            <strong>è¯´æ˜ï¼š</strong>æ‚¨å¯ä»¥é€‰æ‹©å°†å›¾ç‰‡å­˜å‚¨åœ¨æœ¬åœ°æœåŠ¡å™¨æˆ–Cloudflare R2å¯¹è±¡å­˜å‚¨ã€‚R2æä¾›æ›´å¥½çš„å¯æ‰©å±•æ€§å’ŒCDNåŠ é€Ÿã€‚
          </div>

          <div class="settings-row">
            <div class="settings-col-main">
              <div class="config-section">
                <div class="config-header">
                  <h3>å­˜å‚¨æ–¹å¼é€‰æ‹©</h3>
                </div>
                <div class="config-content">
                  <form id="storageConfigForm">
                    <div class="storage-option" id="local-option">
                      <input type="radio" name="storageType" value="local" id="storage-local">
                      <label for="storage-local" class="storage-label">æœ¬åœ°å­˜å‚¨</label>
                      <p class="storage-desc">å›¾ç‰‡å­˜å‚¨åœ¨æœåŠ¡å™¨æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸­</p>
                    </div>

                    <div class="storage-option" id="r2-option">
                      <input type="radio" name="storageType" value="r2" id="storage-r2">
                      <label for="storage-r2" class="storage-label">Cloudflare R2å¯¹è±¡å­˜å‚¨</label>
                      <p class="storage-desc">å›¾ç‰‡å­˜å‚¨åœ¨Cloudflare R2ï¼Œæä¾›å…¨çƒCDNåŠ é€Ÿ</p>

                      <div class="r2-config" id="r2-config">
                        <div class="form-group">
                          <div class="checkbox-group">
                            <input class="form-check-input" type="checkbox" id="r2EnabledSwitch">
                            <label class="form-check-label" for="r2EnabledSwitch">å¯ç”¨R2å­˜å‚¨</label>
                          </div>
                        </div>

                        <div class="form-group">
                          <label class="form-label" for="r2AccessKeyId">Access Key ID</label>
                          <input type="text" class="form-control" id="r2AccessKeyId" placeholder="R2 Access Key ID">
                          <div class="form-help">åœ¨Cloudflareæ§åˆ¶å°çš„R2ç®¡ç†é¡µé¢è·å–</div>
                        </div>

                        <div class="form-group">
                          <label class="form-label" for="r2SecretAccessKey">Secret Access Key</label>
                          <input type="password" class="form-control" id="r2SecretAccessKey" placeholder="R2 Secret Access Key">
                          <div class="form-help">å¯¹åº”çš„å¯†é’¥ï¼Œè¯·å¦¥å–„ä¿ç®¡</div>
                        </div>

                        <div class="form-group">
                          <label class="form-label" for="r2Endpoint">Endpoint</label>
                          <input type="text" class="form-control" id="r2Endpoint" placeholder="https://your-account-id.r2.cloudflarestorage.com">
                          <div class="form-help">R2å­˜å‚¨çš„APIç«¯ç‚¹ï¼Œæ ¼å¼ï¼šhttps://your-account-id.r2.cloudflarestorage.com</div>
                        </div>

                        <div class="form-group">
                          <label class="form-label" for="r2Bucket">Bucketåç§°</label>
                          <input type="text" class="form-control" id="r2Bucket" placeholder="my-image-bucket">
                          <div class="form-help">å­˜å‚¨å›¾ç‰‡çš„Bucketåç§°</div>
                        </div>

                        <div class="form-group">
                          <label class="form-label" for="r2Region">åŒºåŸŸ</label>
                          <input type="text" class="form-control" id="r2Region" placeholder="auto" value="auto">
                          <div class="form-help">é€šå¸¸ä¿æŒ"auto"å³å¯</div>
                        </div>

                        <div class="form-group">
                          <label class="form-label" for="r2CustomDomain">è‡ªå®šä¹‰åŸŸå (å¯é€‰)</label>
                          <input type="text" class="form-control" id="r2CustomDomain" placeholder="cdn.yourdomain.com">
                          <div class="form-help">å¦‚æœæ‚¨é…ç½®äº†è‡ªå®šä¹‰åŸŸåï¼Œè¯·å¡«å†™æ­¤é¡¹ä»¥è·å¾—æ›´å¥½çš„è®¿é—®é€Ÿåº¦</div>
                        </div>

                        <div class="form-group">
                          <button type="button" class="btn btn-secondary" id="testR2Connection">æµ‹è¯•R2è¿æ¥</button>
                          <div id="testResult" class="test-result"></div>
                        </div>
                      </div>
                    </div>

                    <div class="action-buttons">
                      <button type="submit" class="btn btn-primary">ä¿å­˜é…ç½®</button>
                    </div>
                  </form>
                </div>
              </div>
            </div>
            
            <div class="settings-col-sidebar">
              <div class="config-section">
                <div class="config-header">
                  <h3>é…ç½®è¯´æ˜</h3>
                </div>
                <div class="config-content">
                  <h4>æœ¬åœ°å­˜å‚¨</h4>
                  <ul>
                    <li>å›¾ç‰‡å­˜å‚¨åœ¨æœåŠ¡å™¨æœ¬åœ°</li>
                    <li>æ— éœ€é¢å¤–é…ç½®</li>
                    <li>é€‚åˆå°è§„æ¨¡ä½¿ç”¨</li>
                  </ul>

                  <h4>R2å¯¹è±¡å­˜å‚¨</h4>
                  <ul>
                    <li>å…¨çƒCDNåŠ é€Ÿ</li>
                    <li>æ— é™æ‰©å±•æ€§</li>
                    <li>é«˜å¯ç”¨æ€§</li>
                    <li>æˆæœ¬ä¼˜åŒ–</li>
                  </ul>

                  <div class="alert alert-warning">
                    <strong>æ³¨æ„ï¼š</strong>æ›´æ”¹å­˜å‚¨æ–¹å¼ä¸ä¼šå½±å“å·²ä¸Šä¼ çš„æ–‡ä»¶ï¼Œä½†æ–°ä¸Šä¼ çš„æ–‡ä»¶å°†ä½¿ç”¨æ–°çš„å­˜å‚¨æ–¹å¼ã€‚
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
    </div>
  </main>

  <script>
    // å¯¼èˆªç›¸å…³å˜é‡
    let currentSection = 'image-quality';

    // è´¨é‡æè¿°æ˜ å°„
    function getQualityDescription(value) {
      if (value >= 90) return 'æœ€é«˜è´¨é‡';
      if (value >= 80) return 'é«˜è´¨é‡';
      if (value >= 70) return 'ä¸­ç­‰è´¨é‡';
      if (value >= 60) return 'ä½è´¨é‡';
      return 'å‹ç¼©ä¼˜å…ˆ';
    }

    // æ›´æ–°è´¨é‡æ˜¾ç¤º
    function updateQualityDisplay(slider) {
      const value = slider.value;
      const valueSpan = document.getElementById(slider.id + 'Value');
      const descSpan = document.getElementById(slider.id + 'Desc');
      
      valueSpan.textContent = value;
      descSpan.textContent = getQualityDescription(parseInt(value));
    }

    // è´¨é‡é¢„è®¾é…ç½®
    const presets = {
      high: { webp: 92, avif: 85 },
      balanced: { webp: 80, avif: 75 },
      compressed: { webp: 65, avif: 60 }
    };

    // åº”ç”¨é¢„è®¾
    function applyPreset(presetName) {
      const preset = presets[presetName];
      if (!preset) return;

      document.getElementById('webpQuality').value = preset.webp;
      document.getElementById('avifQuality').value = preset.avif;

      // æ›´æ–°æ˜¾ç¤º
      updateQualityDisplay(document.getElementById('webpQuality'));
      updateQualityDisplay(document.getElementById('avifQuality'));
    }

    // æ¢å¤é»˜è®¤è®¾ç½®
    function resetToDefaults() {
      applyPreset('balanced');
      document.getElementById('pngOptimize').checked = true;
    }

    // ä¾§è¾¹æ å¯¼èˆªåˆ‡æ¢
    function switchSection(sectionName) {
      // æ›´æ–°å¯¼èˆªçŠ¶æ€
      document.querySelectorAll('.nav-item').forEach(item => {
        item.classList.remove('active');
      });
      document.querySelector(`[data-section="${sectionName}"]`).classList.add('active');

      // æ›´æ–°å†…å®¹åŒºåŸŸ
      document.querySelectorAll('.settings-section').forEach(section => {
        section.classList.remove('active');
      });
      document.getElementById(`${sectionName}-section`).classList.add('active');

      currentSection = sectionName;

      // æ ¹æ®å½“å‰é€‰æ‹©çš„éƒ¨åˆ†åŠ è½½ç›¸åº”æ•°æ®
      if (sectionName === 'api-management') {
        fetchApiStatus();
      } else if (sectionName === 'storage-config') {
        loadStorageConfig();
      }
    }

    // å¤åˆ¶åŠŸèƒ½
    function copyToClipboard(text, successMessage) {
      if (!text) {
        showMessage('æ²¡æœ‰å¯å¤åˆ¶çš„å†…å®¹', 'error');
        return;
      }
      
      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(text)
          .then(() => showMessage(successMessage))
          .catch((err) => {
            console.error('å¤åˆ¶å¤±è´¥:', err);
            fallbackCopy(text, successMessage);
          });
      } else {
        fallbackCopy(text, successMessage);
      }
    }
    
    function fallbackCopy(text, successMessage) {
      try {
        const textArea = document.createElement('textarea');
        textArea.value = text;
        textArea.style.position = 'fixed';
        textArea.style.top = '0';
        textArea.style.left = '0';
        textArea.style.opacity = '0';
        document.body.appendChild(textArea);
        textArea.focus();
        textArea.select();
        
        const successful = document.execCommand('copy');
        if (successful) {
          showMessage(successMessage);
        } else {
          showMessage('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶', 'error');
        }
        
        document.body.removeChild(textArea);
      } catch (err) {
        console.error('å¤‡ç”¨å¤åˆ¶æ–¹æ³•å¤±è´¥:', err);
        showMessage('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶', 'error');
      }
    }

    // å¤åˆ¶æ–°ä»¤ç‰Œ
    window.copyNewToken = function() {
      const tokenValue = document.getElementById('newTokenValue').textContent;
      copyToClipboard(tokenValue, 'ä»¤ç‰Œå·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
    };

    // å¤åˆ¶ç°æœ‰ä»¤ç‰Œ
    window.copyExistingToken = function(token) {
      copyToClipboard(token, 'ä»¤ç‰Œå·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
    };

    // APIç®¡ç†ç›¸å…³å‡½æ•°
    function fetchApiStatus() {
      fetch('/api/tokens')
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            // æ›´æ–°APIå¼€å…³çŠ¶æ€
            document.getElementById('apiEnabledSwitch').checked = data.enabled;
            document.getElementById('apiDisabledWarning').style.display = data.enabled ? 'none' : 'block';
            
            // æ›´æ–°é»˜è®¤æ ¼å¼é€‰æ‹©
            const formatRadios = document.getElementsByName('defaultFormat');
            formatRadios.forEach(radio => {
              radio.checked = radio.value === data.defaultFormat;
            });
            
            // æ›´æ–°ä»¤ç‰Œåˆ—è¡¨
            renderTokenList(data.tokens);
          }
        })
        .catch(error => {
          console.error('è·å–APIçŠ¶æ€å¤±è´¥:', error);
        });
    }

    function renderTokenList(tokens) {
      const tokenListElem = document.getElementById('tokenList');
      const noTokensMessage = document.getElementById('noTokensMessage');
      
      if (tokens.length === 0) {
        noTokensMessage.style.display = 'block';
        tokenListElem.innerHTML = '';
        return;
      }
      
      noTokensMessage.style.display = 'none';
      tokenListElem.innerHTML = '';
      
      tokens.forEach(token => {
        const createdDate = new Date(token.createdAt).toLocaleString();
        const expiresDate = token.expiresAt ? new Date(token.expiresAt).toLocaleString() : 'æ°¸ä¸è¿‡æœŸ';
        
        const tokenDiv = document.createElement('div');
        tokenDiv.className = 'token-item';
        tokenDiv.innerHTML = `
          <div class="token-header">
            <h4>${token.name}</h4>
            <button class="btn btn-danger btn-sm delete-token-btn" data-token-id="${token.id}">åˆ é™¤</button>
          </div>
          <div class="token-value" onclick="copyExistingToken('${token.token}')" title="ç‚¹å‡»å¤åˆ¶ä»¤ç‰Œ">${token.token}</div>
          <div class="token-info">
            <div>åˆ›å»ºæ—¶é—´: ${createdDate}</div>
            <div>è¿‡æœŸæ—¶é—´: ${expiresDate}</div>
          </div>
        `;
        
        tokenListElem.appendChild(tokenDiv);
      });

      // æ·»åŠ åˆ é™¤æŒ‰é’®äº‹ä»¶ç›‘å¬å™¨
      document.querySelectorAll('.delete-token-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const tokenId = this.dataset.tokenId;
          if (confirm('ç¡®å®šè¦åˆ é™¤æ­¤ä»¤ç‰Œå—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚')) {
            deleteToken(tokenId);
          }
        });
      });
    }

    function createToken() {
      const tokenName = document.getElementById('tokenName').value.trim();
      
      if (!tokenName) {
        showMessage('è¯·è¾“å…¥ä»¤ç‰Œåç§°', 'error');
        return;
      }
      
      fetch('/api/tokens', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          name: tokenName
        })
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          // æ˜¾ç¤ºæ–°åˆ›å»ºçš„ä»¤ç‰Œ
          document.getElementById('newTokenValue').textContent = data.token.token;
          document.getElementById('newTokenInfo').style.display = 'block';
          
          // æ¸…ç©ºè¾“å…¥å¹¶é‡æ–°åŠ è½½ä»¤ç‰Œåˆ—è¡¨
          document.getElementById('tokenName').value = '';
          fetchApiStatus();
        } else {
          showMessage('åˆ›å»ºä»¤ç‰Œå¤±è´¥: ' + (data.message || 'æœªçŸ¥é”™è¯¯'), 'error');
        }
      })
      .catch(error => {
        console.error('åˆ›å»ºä»¤ç‰Œè¯·æ±‚å¤±è´¥:', error);
        showMessage('åˆ›å»ºä»¤ç‰Œè¯·æ±‚å¤±è´¥ï¼Œè¯·ç¨åå†è¯•', 'error');
      });
    }

    function toggleApiStatus() {
      fetch('/api/toggle', {
        method: 'POST'
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          // æ›´æ–°å¼€å…³çŠ¶æ€å’Œè­¦å‘Šæ¶ˆæ¯
          document.getElementById('apiEnabledSwitch').checked = data.enabled;
          document.getElementById('apiDisabledWarning').style.display = data.enabled ? 'none' : 'block';
          showMessage('APIçŠ¶æ€å·²æ›´æ–°');
        } else {
          showMessage('åˆ‡æ¢APIçŠ¶æ€å¤±è´¥: ' + (data.message || 'æœªçŸ¥é”™è¯¯'), 'error');
          // é‡ç½®å¼€å…³çŠ¶æ€
          fetchApiStatus();
        }
      })
      .catch(error => {
        console.error('åˆ‡æ¢APIçŠ¶æ€è¯·æ±‚å¤±è´¥:', error);
        showMessage('åˆ‡æ¢APIçŠ¶æ€è¯·æ±‚å¤±è´¥ï¼Œè¯·ç¨åå†è¯•', 'error');
        // é‡ç½®å¼€å…³çŠ¶æ€
        fetchApiStatus();
      });
    }

    function updateDefaultFormat(format) {
      fetch('/api/format', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ format })
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          showMessage('é»˜è®¤æ ¼å¼è®¾ç½®å·²æ›´æ–°');
        } else {
          showMessage('æ›´æ–°é»˜è®¤æ ¼å¼å¤±è´¥: ' + (data.message || 'æœªçŸ¥é”™è¯¯'), 'error');
          // é‡ç½®æ ¼å¼é€‰æ‹©
          fetchApiStatus();
        }
      })
      .catch(error => {
        console.error('æ›´æ–°é»˜è®¤æ ¼å¼è¯·æ±‚å¤±è´¥:', error);
        showMessage('æ›´æ–°é»˜è®¤æ ¼å¼è¯·æ±‚å¤±è´¥ï¼Œè¯·ç¨åå†è¯•', 'error');
        // é‡ç½®æ ¼å¼é€‰æ‹©
        fetchApiStatus();
      });
    }

    function deleteToken(tokenId) {
      fetch(`/api/tokens/${tokenId}`, {
        method: 'DELETE'
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          showMessage('ä»¤ç‰Œåˆ é™¤æˆåŠŸ');
          // é‡æ–°åŠ è½½ä»¤ç‰Œåˆ—è¡¨
          fetchApiStatus();
        } else {
          showMessage('åˆ é™¤ä»¤ç‰Œå¤±è´¥: ' + (data.message || 'æœªçŸ¥é”™è¯¯'), 'error');
        }
      })
      .catch(error => {
        console.error('åˆ é™¤ä»¤ç‰Œè¯·æ±‚å¤±è´¥:', error);
        showMessage('åˆ é™¤ä»¤ç‰Œè¯·æ±‚å¤±è´¥ï¼Œè¯·ç¨åå†è¯•', 'error');
      });
    }

    // å­˜å‚¨é…ç½®ç›¸å…³å‡½æ•°
    function loadStorageConfig() {
      fetch('/api/storage-config')
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            const config = data.config;
            
            // è®¾ç½®å­˜å‚¨ç±»å‹
            document.querySelector(`input[value="${config.type}"]`).checked = true;
            toggleStorageOption(config.type);
            
            // è®¾ç½®R2é…ç½®
            if (config.r2) {
              document.getElementById('r2EnabledSwitch').checked = config.r2.enabled;
              document.getElementById('r2Endpoint').value = config.r2.endpoint || '';
              document.getElementById('r2Bucket').value = config.r2.bucket || '';
              document.getElementById('r2Region').value = config.r2.region || 'auto';
              document.getElementById('r2CustomDomain').value = config.r2.customDomain || '';
              
              // ä¸æ˜¾ç¤ºæ•æ„Ÿä¿¡æ¯ï¼Œåªæ˜¾ç¤ºæ˜¯å¦å·²é…ç½®
              if (config.r2.hasCredentials) {
                document.getElementById('r2AccessKeyId').placeholder = 'å·²é…ç½® (ç•™ç©ºä¿æŒä¸å˜)';
                document.getElementById('r2SecretAccessKey').placeholder = 'å·²é…ç½® (ç•™ç©ºä¿æŒä¸å˜)';
              }
            }
          }
        })
        .catch(error => {
          console.error('åŠ è½½é…ç½®å¤±è´¥:', error);
        });
    }

    function toggleStorageOption(storageType) {
      // æ›´æ–°è§†è§‰çŠ¶æ€
      document.querySelectorAll('.storage-option').forEach(option => option.classList.remove('active'));
      document.getElementById(`${storageType}-option`).classList.add('active');

      // æ˜¾ç¤º/éšè—R2é…ç½®
      const r2Config = document.getElementById('r2-config');
      if (storageType === 'r2') {
        r2Config.style.display = 'block';
      } else {
        r2Config.style.display = 'none';
      }
    }

    function saveStorageConfig() {
      const formData = new FormData(document.getElementById('storageConfigForm'));
      const storageType = formData.get('storageType');
      
      const configData = {
        type: storageType,
        r2: {
          enabled: document.getElementById('r2EnabledSwitch').checked,
          endpoint: document.getElementById('r2Endpoint').value,
          bucket: document.getElementById('r2Bucket').value,
          region: document.getElementById('r2Region').value,
          customDomain: document.getElementById('r2CustomDomain').value
        }
      };
      
      // åªæœ‰åœ¨æœ‰å€¼æ—¶æ‰åŒ…å«æ•æ„Ÿä¿¡æ¯
      const accessKeyId = document.getElementById('r2AccessKeyId').value;
      const secretAccessKey = document.getElementById('r2SecretAccessKey').value;
      if (accessKeyId) configData.r2.accessKeyId = accessKeyId;
      if (secretAccessKey) configData.r2.secretAccessKey = secretAccessKey;
      
      fetch('/api/storage-config', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(configData)
      })
      .then(response => response.json())
      .then(result => {
        if (result.success) {
          showMessage('é…ç½®ä¿å­˜æˆåŠŸï¼');
          // é‡æ–°åŠ è½½é…ç½®ä»¥æ›´æ–°å ä½ç¬¦
          loadStorageConfig();
        } else {
          showMessage('ä¿å­˜å¤±è´¥ï¼š' + result.message, 'error');
        }
      })
      .catch(error => {
        console.error('ä¿å­˜é…ç½®å¤±è´¥:', error);
        showMessage('ä¿å­˜å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥', 'error');
      });
    }

    function testR2Connection() {
      const testButton = document.getElementById('testR2Connection');
      const testResult = document.getElementById('testResult');
      
      testResult.style.display = 'none';
      testButton.disabled = true;
      testButton.textContent = 'æµ‹è¯•ä¸­...';
      
      fetch('/api/test-r2', {
        method: 'POST'
      })
      .then(response => response.json())
      .then(result => {
        testResult.style.display = 'block';
        if (result.success) {
          testResult.className = 'test-result success';
          testResult.textContent = result.message;
        } else {
          testResult.className = 'test-result error';
          testResult.textContent = result.message;
        }
      })
      .catch(error => {
        testResult.style.display = 'block';
        testResult.className = 'test-result error';
        testResult.textContent = 'æµ‹è¯•å¤±è´¥ï¼š' + error.message;
      })
      .finally(() => {
        testButton.disabled = false;
        testButton.textContent = 'æµ‹è¯•R2è¿æ¥';
      });
    }

    // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', function() {
      // æ£€æŸ¥è®¤è¯çŠ¶æ€
      checkAuthStatus();

      // åŠ è½½å½“å‰è®¾ç½®
      loadCurrentSettings();

      // æ›´æ–°APIç«¯ç‚¹URL
      const baseUrl = window.location.origin;
      document.getElementById('apiEndpoint').textContent = baseUrl + '/api/upload';

      // æ·»åŠ ä¾§è¾¹æ å¯¼èˆªäº‹ä»¶ç›‘å¬å™¨
      document.querySelectorAll('.nav-item').forEach(item => {
        item.addEventListener('click', function(e) {
          e.preventDefault();
          const sectionName = this.dataset.section;
          switchSection(sectionName);
        });
      });

      // æ·»åŠ è´¨é‡æ»‘å—äº‹ä»¶ç›‘å¬å™¨
      const qualitySliders = document.querySelectorAll('.quality-slider');
      qualitySliders.forEach(slider => {
        slider.addEventListener('input', () => updateQualityDisplay(slider));
      });

      // æ·»åŠ é¢„è®¾æŒ‰é’®äº‹ä»¶ç›‘å¬å™¨
      const presetButtons = document.querySelectorAll('.preset-btn');
      presetButtons.forEach(btn => {
        btn.addEventListener('click', function() {
          const presetCard = this.closest('.preset-card');
          const preset = presetCard.dataset.preset;
          applyPreset(preset);
        });
      });

      // æ¢å¤é»˜è®¤æŒ‰é’®
      document.getElementById('resetDefaults').addEventListener('click', resetToDefaults);

      // ä¿å­˜è´¨é‡è®¾ç½®
      document.getElementById('qualitySettingsForm').addEventListener('submit', saveQualitySettings);

      // APIç®¡ç†äº‹ä»¶ç›‘å¬å™¨
      document.getElementById('createTokenForm').addEventListener('submit', function(e) {
        e.preventDefault();
        createToken();
      });
      
      document.getElementById('apiEnabledSwitch').addEventListener('change', function() {
        toggleApiStatus();
      });

      document.getElementsByName('defaultFormat').forEach(radio => {
        radio.addEventListener('change', function() {
          updateDefaultFormat(this.value);
        });
      });

      // å­˜å‚¨é…ç½®äº‹ä»¶ç›‘å¬å™¨
      document.querySelectorAll('input[name="storageType"]').forEach(radio => {
        radio.addEventListener('change', function() {
          toggleStorageOption(this.value);
        });
      });

      document.getElementById('storageConfigForm').addEventListener('submit', function(e) {
        e.preventDefault();
        saveStorageConfig();
      });

      document.getElementById('testR2Connection').addEventListener('click', testR2Connection);

      // æš—è‰²æ¨¡å¼åˆ‡æ¢æŒ‰é’®
      const darkModeToggle = document.getElementById('toggleDarkMode');
      darkModeToggle.addEventListener('click', function() {
        document.body.classList.toggle('dark');
        // ä¿å­˜æ¨¡å¼åå¥½åˆ°localStorage
        const isDark = document.body.classList.contains('dark');
        localStorage.setItem('darkMode', isDark ? 'true' : 'false');
        darkModeToggle.textContent = isDark ? 'äº®è‰²æ¨¡å¼' : 'æš—è‰²æ¨¡å¼';
      });
      
      // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥æš—è‰²æ¨¡å¼
      const storedDarkMode = localStorage.getItem('darkMode');
      if (storedDarkMode === 'true') {
        document.body.classList.add('dark');
        darkModeToggle.textContent = 'äº®è‰²æ¨¡å¼';
      }
    });

    // æ£€æŸ¥è®¤è¯çŠ¶æ€
    async function checkAuthStatus() {
      try {
        const response = await fetch('/api/auth-status');
        const data = await response.json();
        
        if (!data.isConfigured) {
          window.location.href = '/setup';
          return;
        }
        
        if (!data.isAuthenticated) {
          window.location.href = '/login';
          return;
        }
      } catch (error) {
        console.error('æ£€æŸ¥è®¤è¯çŠ¶æ€å¤±è´¥:', error);
        window.location.href = '/login';
      }
    }

    // åŠ è½½å½“å‰è®¾ç½®
    async function loadCurrentSettings() {
      try {
        const response = await fetch('/api/settings');
        if (response.ok) {
          const settings = await response.json();
          
          // åº”ç”¨è´¨é‡è®¾ç½®
          if (settings.imageQuality) {
            if (settings.imageQuality.webp !== undefined) {
              document.getElementById('webpQuality').value = settings.imageQuality.webp;
            }
            if (settings.imageQuality.avif !== undefined) {
              document.getElementById('avifQuality').value = settings.imageQuality.avif;
            }
            if (settings.imageQuality.pngOptimize !== undefined) {
              document.getElementById('pngOptimize').checked = settings.imageQuality.pngOptimize;
            }
          }

          // æ›´æ–°æ˜¾ç¤º
          const qualitySliders = document.querySelectorAll('.quality-slider');
          qualitySliders.forEach(slider => updateQualityDisplay(slider));
        }
      } catch (error) {
        console.error('åŠ è½½è®¾ç½®å¤±è´¥:', error);
      }
    }

    // ä¿å­˜è´¨é‡è®¾ç½®
    async function saveQualitySettings(e) {
      e.preventDefault();
      
      const settings = {
        imageQuality: {
          webp: parseInt(document.getElementById('webpQuality').value),
          avif: parseInt(document.getElementById('avifQuality').value),
          pngOptimize: document.getElementById('pngOptimize').checked
        }
      };

      try {
        const response = await fetch('/api/settings', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(settings)
        });

        if (response.ok) {
          showMessage('è´¨é‡è®¾ç½®ä¿å­˜æˆåŠŸï¼', 'success');
        } else {
          const error = await response.json();
          showMessage('ä¿å­˜å¤±è´¥: ' + (error.message || 'æœªçŸ¥é”™è¯¯'), 'error');
        }
      } catch (error) {
        console.error('ä¿å­˜è®¾ç½®å¤±è´¥:', error);
        showMessage('ä¿å­˜å¤±è´¥: ' + error.message, 'error');
      }
    }

    // æ˜¾ç¤ºæ¶ˆæ¯
    function showMessage(message, type = 'success') {
      // åˆ›å»ºæ¶ˆæ¯å…ƒç´ 
      const messageEl = document.createElement('div');
      messageEl.className = `message ${type}`;
      messageEl.textContent = message;
      messageEl.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 12px 20px;
        border-radius: 6px;
        color: white;
        font-weight: 500;
        z-index: 1000;
        opacity: 0;
        transform: translateX(100%);
        transition: all 0.3s ease;
        ${type === 'success' ? 'background-color: #22c55e;' : 'background-color: #ef4444;'}
      `;

      document.body.appendChild(messageEl);

      // æ˜¾ç¤ºåŠ¨ç”»
      setTimeout(() => {
        messageEl.style.opacity = '1';
        messageEl.style.transform = 'translateX(0)';
      }, 100);

      // è‡ªåŠ¨éšè—
      setTimeout(() => {
        messageEl.style.opacity = '0';
        messageEl.style.transform = 'translateX(100%)';
        setTimeout(() => {
          if (document.body.contains(messageEl)) {
            document.body.removeChild(messageEl);
          }
        }, 300);
      }, 3000);
    }
  </script>

  <style>
    /* åŸºç¡€æ ·å¼ */
    .settings-container {
      max-width: 1400px;
    }

    .page-header {
      text-align: center;
      margin-bottom: 2rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid var(--border-color);
    }

    .page-header h1 {
      margin: 0 0 0.5rem 0;
      color: var(--text-primary);
    }

    .subtitle {
      margin: 0;
      color: var(--text-secondary);
    }

    /* è®¾ç½®é¡µé¢å¸ƒå±€ */
    .settings-layout {
      display: flex;
      gap: 2rem;
      margin-top: 2rem;
    }

    /* ä¾§è¾¹æ æ ·å¼ */
    .settings-sidebar {
      width: 280px;
      flex-shrink: 0;
    }

    .settings-nav {
      background: var(--bg-secondary);
      border-radius: 12px;
      padding: 1rem;
      border: 1px solid var(--border-color);
      position: sticky;
      top: 2rem;
    }

    .nav-item {
      display: flex;
      align-items: center;
      padding: 0.75rem 1rem;
      margin-bottom: 0.5rem;
      border-radius: 8px;
      text-decoration: none;
      color: var(--text-secondary);
      transition: all 0.2s ease;
      cursor: pointer;
    }

    .nav-item:hover {
      background: var(--primary-light);
      color: var(--primary-color);
    }

    .nav-item.active {
      background: var(--primary-color);
      color: white;
    }

    .nav-item:last-child {
      margin-bottom: 0;
    }

    .nav-icon {
      margin-right: 0.75rem;
      font-size: 1.2rem;
    }

    /* ä¸»è¦å†…å®¹åŒºåŸŸ */
    .settings-content {
      flex: 1;
      min-width: 0;
    }

    .settings-section {
      display: none;
    }

    .settings-section.active {
      display: block;
    }

    .section-header {
      margin-bottom: 2rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid var(--border-color);
    }

    .section-header h2 {
      margin: 0 0 0.5rem 0;
      color: var(--text-primary);
    }

    .section-header h3 {
      margin: 2rem 0 0.5rem 0;
      color: var(--text-primary);
    }

    .section-description {
      margin: 0;
      color: var(--text-secondary);
      font-size: 0.9rem;
    }

    /* é…ç½®åŒºå—æ ·å¼ */
    .config-section {
      background: var(--bg-secondary);
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 2rem;
      border: 1px solid var(--border-color);
    }

    .config-header {
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid var(--border-color);
    }

    .config-header h3 {
      margin: 0 0 0.5rem 0;
      color: var(--text-primary);
    }

    .config-content {
      margin-top: 1rem;
    }

    /* åŒæ å¸ƒå±€ */
    .settings-row {
      display: flex;
      gap: 2rem;
    }

    .settings-col-main {
      flex: 2;
      min-width: 0;
    }

    .settings-col-sidebar {
      flex: 1;
      min-width: 300px;
    }

    /* è¡¨å•æ ·å¼ */
    .form-group {
      margin-bottom: 1.5rem;
    }

    .form-label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
      color: var(--text-primary);
    }

    .form-control {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid var(--border-color);
      border-radius: var(--input-border-radius);
      background-color: var(--bg-primary);
      color: var(--text-color);
      transition: border-color 0.2s ease;
    }

    .form-control:focus {
      border-color: var(--primary-color);
      outline: none;
      box-shadow: 0 0 0 2px rgba(67, 97, 238, 0.2);
    }

    .form-help {
      color: var(--text-secondary);
      font-size: 0.85rem;
      margin-top: 0.25rem;
    }

    /* è´¨é‡è®¾ç½®æ ·å¼ */
    .quality-value {
      font-weight: 600;
      color: var(--primary-color);
    }

    .quality-control {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .quality-slider {
      width: 100%;
      height: 6px;
      border-radius: 3px;
      background: var(--border-color);
      outline: none;
      -webkit-appearance: none;
    }

    .quality-slider::-webkit-slider-thumb {
      appearance: none;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: var(--primary-color);
      cursor: pointer;
      border: 2px solid white;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .quality-slider::-moz-range-thumb {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: var(--primary-color);
      cursor: pointer;
      border: 2px solid white;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .quality-info {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .quality-desc {
      font-weight: 500;
      color: var(--primary-color);
    }

    .quality-hint {
      color: var(--text-secondary);
      font-size: 0.8rem;
    }

    /* é¢„è®¾å¡ç‰‡æ ·å¼ */
    .preset-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1rem;
    }

    .preset-card {
      background: var(--bg-primary);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 1rem;
      text-align: center;
    }

    .preset-card h4 {
      margin: 0 0 0.5rem 0;
      color: var(--text-primary);
    }

    .preset-desc {
      margin: 0 0 0.5rem 0;
      font-weight: 500;
      color: var(--primary-color);
      font-size: 0.9rem;
    }

    .preset-usage {
      margin: 0 0 1rem 0;
      color: var(--text-secondary);
      font-size: 0.8rem;
    }

    .preset-btn {
      width: 100%;
    }

    /* å¤é€‰æ¡†æ ·å¼ */
    .checkbox-group {
      margin-top: 0.5rem;
    }

    .checkbox-label {
      display: flex;
      align-items: center;
      cursor: pointer;
      font-size: 0.9rem;
    }

    .checkbox-label input[type="checkbox"] {
      margin-right: 0.5rem;
    }

    /* å¼€å…³æŒ‰é’®æ ·å¼ */
    .form-check-input {
      margin-right: 0.75rem;
      height: 20px;
      width: 40px;
      cursor: pointer;
      appearance: none;
      background-color: var(--gray-400);
      border-radius: 20px;
      position: relative;
      transition: background-color 0.3s;
    }

    .form-check-input:checked {
      background-color: var(--primary-color);
    }

    .form-check-input:before {
      content: '';
      position: absolute;
      height: 16px;
      width: 16px;
      left: 2px;
      bottom: 2px;
      background-color: white;
      border-radius: 50%;
      transition: transform 0.3s;
    }

    .form-check-input:checked:before {
      transform: translateX(20px);
    }

    .form-check-label {
      cursor: pointer;
      font-weight: 500;
    }

    /* APIç®¡ç†æ ·å¼ */
    .api-switch {
      margin-bottom: 1.5rem;
      display: flex;
      align-items: center;
    }

    .format-radio-group {
      margin-top: 1rem;
      padding: 1rem;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      background-color: var(--bg-primary);
    }

    .format-radio-group h4 {
      margin: 0 0 1rem 0;
      color: var(--text-primary);
    }

    .radio-group {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .radio-item {
      display: flex;
      align-items: center;
    }

    .radio-item input[type="radio"] {
      margin-right: 0.5rem;
    }

    /* ä»¤ç‰Œç›¸å…³æ ·å¼ */
    .token-list {
      margin-top: 1rem;
    }

    .token-item {
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 1rem;
      background-color: var(--bg-primary);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .token-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .token-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.75rem;
    }

    .token-header h4 {
      margin: 0;
      color: var(--text-primary);
    }

    .token-value {
      background-color: var(--bg-secondary);
      padding: 0.75rem;
      border-radius: 6px;
      font-family: monospace;
      word-break: break-all;
      cursor: pointer;
      margin-bottom: 0.75rem;
      border: 1px dashed var(--border-color);
      transition: border-color 0.2s ease;
    }

    .token-value:hover {
      border-color: var(--primary-color);
    }

    .token-info {
      font-size: 0.85rem;
      color: var(--text-secondary);
    }

    .new-token-value {
      background-color: var(--bg-secondary);
      border: 1px dashed var(--primary-color);
      padding: 0.75rem;
      margin: 0.75rem 0;
      font-family: monospace;
      border-radius: 6px;
      word-break: break-all;
    }

    .no-data-message {
      text-align: center;
      padding: 2rem;
      color: var(--text-secondary);
      font-style: italic;
    }

    /* å­˜å‚¨é…ç½®æ ·å¼ */
    .storage-option {
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 1rem;
      background-color: var(--bg-primary);
      transition: border-color 0.3s, background-color 0.3s;
      cursor: pointer;
    }

    .storage-option:hover {
      border-color: var(--primary-color);
    }

    .storage-option.active {
      border-color: var(--primary-color);
      background-color: var(--primary-light);
    }

    .storage-option input[type="radio"] {
      margin-right: 0.75rem;
    }

    .storage-label {
      font-weight: 500;
      font-size: 1.1rem;
    }

    .storage-desc {
      margin: 0.5rem 0 0 1.75rem;
      color: var(--text-secondary);
      font-size: 0.9rem;
    }

    .r2-config {
      margin-top: 1rem;
      padding: 1rem;
      background-color: var(--bg-secondary);
      border-radius: 8px;
      margin-left: 1.75rem;
      display: none;
    }

    .r2-config.show {
      display: block;
    }

    /* æµ‹è¯•ç»“æœæ ·å¼ */
    .test-result {
      margin-top: 1rem;
      padding: 0.75rem;
      border-radius: 6px;
      display: none;
    }

    .test-result.success {
      background-color: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .test-result.error {
      background-color: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    /* æç¤ºæ¡†æ ·å¼ */
    .alert {
      padding: 1rem;
      border-radius: 8px;
      margin-bottom: 1.5rem;
    }

    .alert-info {
      background-color: #d1ecf1;
      color: #0c5460;
      border: 1px solid #b6d4ea;
    }

    .alert-warning {
      background-color: #fff3cd;
      color: #856404;
      border: 1px solid #ffeaa7;
    }

    .alert-success {
      background-color: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    /* ä¿¡æ¯æ¡†æ ·å¼ */
    .info-box {
      background: var(--bg-secondary);
      padding: 1rem;
      border-radius: 8px;
      margin: 1rem 0;
      border: 1px solid var(--border-color);
    }

    .info-box h4 {
      margin: 0 0 0.75rem 0;
      color: var(--text-primary);
    }

    .info-box ul {
      margin: 0.5rem 0;
      padding-left: 1.5rem;
    }

    .info-box li {
      margin-bottom: 0.25rem;
    }

    /* ä»£ç æ ·å¼ */
    code {
      background-color: var(--bg-secondary);
      padding: 2px 6px;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      font-size: 0.9em;
      color: var(--primary-color);
    }

    /* æŒ‰é’®æ ·å¼ */
    .action-buttons {
      display: flex;
      gap: 1rem;
      justify-content: flex-end;
      margin-top: 1.5rem;
    }

    .btn-sm {
      padding: 0.25rem 0.75rem;
      font-size: 0.875rem;
    }

    .btn-danger {
      background-color: #dc3545;
      border-color: #dc3545;
      color: white;
    }

    .btn-danger:hover {
      background-color: #c82333;
      border-color: #bd2130;
    }

    /* å“åº”å¼è®¾è®¡ */
    @media (max-width: 1024px) {
      .settings-layout {
        flex-direction: column;
      }

      .settings-sidebar {
        width: 100%;
      }

      .settings-nav {
        position: static;
        display: flex;
        overflow-x: auto;
        padding: 0.5rem;
      }

      .nav-item {
        white-space: nowrap;
        margin-right: 0.5rem;
        margin-bottom: 0;
      }

      .settings-row {
        flex-direction: column;
      }

      .settings-col-sidebar {
        min-width: 0;
      }
    }

    @media (max-width: 768px) {
      .action-buttons {
        flex-direction: column;
      }
      
      .preset-grid {
        grid-template-columns: 1fr;
      }
      
      .quality-info {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.25rem;
      }

      .radio-group {
        flex-direction: column;
        gap: 0.5rem;
      }

      .token-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.5rem;
      }
    }
  </style>
</body>
</html> 